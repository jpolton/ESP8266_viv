<!DOCTYPE html>
<html>
  <head>
    <!-- EXTERNAL LIBS-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://www.google.com/jsapi"></script>

    <!-- EXAMPLE SCRIPT -->
    <script>

      // onload callback
      function drawChart() {

        var public_key = 'XGYoZzy8ExFQYmQr3xRd';

        // JSONP request
        var jsonData = $.ajax({
          url: 'https://data.sparkfun.com/output/' + public_key + '.json',
          data: {page: 1},
          dataType: 'jsonp',
        }).done(function (results) {

          var data = new google.visualization.DataTable();

          data.addColumn('datetime', 'Time');
          data.addColumn('number', 'humidity top');
          data.addColumn('number', 'temperature top');
          data.addColumn('number', 'humidity bot');
          data.addColumn('number', 'temperature bot');

          $.each(results, function (i, row) {
            data.addRow([
              (new Date(row.timestamp)),
              parseFloat(row.hum_top),
              parseFloat(row.temp_top)
              parseFloat(row.hum_bot),
              parseFloat(row.temp_bot)
            ]);
          });

	  //var data_national = new google.visualization.DataTable()
	  
	  //data_national.addColumn( data.selectColumn(1) )
	  //data_national = clone(data)
	  //data_national.removeColumns(1,6)

	  //data_regional = data.clone()
	  //data_regional.setColumns([1,2])
	  //data_regional.removeColumns(7,6)

	  var temp = new google.visualization.DataView(data);
	  temp.setColumns([0,2]); //here you set the columns you want to display
	  //temp.setRows([0,1,2,3,4,5,6,7,8,9,10]); //here you set the rows you want to display
	
	  var hum = new google.visualization.DataView(data);
	  hum.setColumns([0,1]); //here you set the columns you want to display
	  //hum.setRows([0,1,2,3,4,5,6,7,8,9,10]); //here you set the rows you want to display

          var chart_temp = new google.visualization.LineChart($('#chart_temp').get(0));

          chart_temp.draw(temp, {
		 vAxis: { 
			title: 'temperature (C)'
	//	 	viewWindow: { min: 10, max:30 }
		  },
		'width':1000,
		'height':400,
		colors: ['red'],
		legend: { position: 'none' },
		chartArea: {  width: "70%", height: "70%" },
		hAxis: {
		    title : 'time'
	//	    viewWindow: {
	//		min: new Date(2016, 6, 24, 20, 30),
	//		max: new Date(2016, 6, 24, 21, 30)
		    }
		}
		);


          var chart_hum = new google.visualization.LineChart($('#chart_hum').get(0));

          chart_hum.draw(hum, {
		  vAxis: { title: 'humidity (%)' },
		  'width':1000,
		  'height':400,
		  legend: { position: 'none' },
		  colors: ['green'],
		  chartArea: {  width: "70%", height: "60%" },
		hAxis: { title: 'time' }
          });
}) };


      // load chart lib
      google.load('visualization', '1', {
        packages: ['corechart']
      });

      // call drawChart once google charts is loaded
      google.setOnLoadCallback(drawChart);

    </script>

  </head>
  <body>
	  <H1>Temperature and humidity logs</H1>
	  Temperature and humidity are logged with a DHT22 on an ESP8266.<BR> They are posted to a data.sparkfun.com stream:<BR> https://data.sparkfun.com/streams/XGYoZzy8ExFQYmQr3xRd
	  <BR>
	  The data are plotted with the  google charts API at:<BR>
	  http://pcwww.liv.ac.uk/~jpolton/plots/esp8266_dht22.html
	  
	  <div id="chart_temp" style="width: 80%;"></div>
    <div id="chart_hum" style="width: 80%;"></div>
  </body>
</html>
